<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administratora - Book Lovers</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">ðŸ“š Book Lovers</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/books">KsiÄ…Å¼ki</a>
                <a class="nav-link" href="/admin">Panel Admin</a>
                <form th:action="@{/logout}" method="post" class="d-inline">
                    <button type="submit" class="btn btn-link nav-link">Wyloguj</button>
                </form>
            </div>
        </div>
    </nav>
    
    <div class="container mt-4">
        <h1>Panel Administratora</h1>
        
        <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
            <span th:text="${success}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <span th:text="${error}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        
        <!-- Tabs -->
        <ul class="nav nav-tabs mb-4" id="adminTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="books-tab" data-bs-toggle="tab" data-bs-target="#books" type="button" role="tab">KsiÄ…Å¼ki</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button" role="tab">UÅ¼ytkownicy</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="authors-tab" data-bs-toggle="tab" data-bs-target="#authors" type="button" role="tab">Autorzy</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews" type="button" role="tab">Recenzje</button>
            </li>
        </ul>
        
        <div class="tab-content" id="adminTabsContent">
            <!-- Books Tab -->
            <div class="tab-pane fade show active" id="books" role="tabpanel">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2>ZarzÄ…dzanie ksiÄ…Å¼kami</h2>
                    <a th:href="@{/books/add}" class="btn btn-success">+ Dodaj ksiÄ…Å¼kÄ™</a>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>TytuÅ‚</th>
                                <th>Autor</th>
                                <th>ISBN</th>
                                <th>Akcje</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="book : ${books}">
                                <td th:text="${book.id}">1</td>
                                <td th:text="${book.title}">TytuÅ‚</td>
                                <td th:text="${book.author}">Autor</td>
                                <td th:text="${book.isbn ?: '-'}">ISBN</td>
                                <td>
                                    <a th:href="@{/books/{id}(id=${book.id})}" class="btn btn-sm btn-info">SzczegÃ³Å‚y</a>
                                    <a th:href="@{/admin/books/{id}/edit(id=${book.id})}" class="btn btn-sm btn-warning">Edytuj</a>
                                    <form th:action="@{/admin/books/{id}/delete(id=${book.id})}" method="post" class="d-inline" onsubmit="return confirm('Czy na pewno chcesz usunÄ…Ä‡ tÄ™ ksiÄ…Å¼kÄ™?');">
                                        <button type="submit" class="btn btn-sm btn-danger">UsuÅ„</button>
                                    </form>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Users Tab -->
            <div class="tab-pane fade" id="users" role="tabpanel">
                <h2>ZarzÄ…dzanie uÅ¼ytkownikami</h2>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nazwa uÅ¼ytkownika</th>
                                <th>Email</th>
                                <th>Rola</th>
                                <th>Status</th>
                                <th>Akcje</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="user : ${users}">
                                <td th:text="${user.id}">1</td>
                                <td th:text="${user.username}">username</td>
                                <td th:text="${user.email}">email</td>
                                <td>
                                    <span class="badge" th:classappend="${user.role == T(com.booklovers.entity.User.Role).ADMIN} ? 'bg-danger' : 'bg-secondary'" 
                                          th:text="${user.role}">USER</span>
                                </td>
                                <td>
                                    <span class="badge" th:classappend="${user.isBlocked} ? 'bg-danger' : 'bg-success'"
                                          th:text="${user.isBlocked} ? 'Zablokowany' : 'Aktywny'">Aktywny</span>
                                </td>
                                <td>
                                    <form th:if="${!user.isBlocked}" th:action="@{/admin/users/{id}/block(id=${user.id})}" method="post" class="d-inline">
                                        <button type="submit" class="btn btn-sm btn-warning">Zablokuj</button>
                                    </form>
                                    <form th:if="${user.isBlocked}" th:action="@{/admin/users/{id}/unblock(id=${user.id})}" method="post" class="d-inline">
                                        <button type="submit" class="btn btn-sm btn-success">Odblokuj</button>
                                    </form>
                                    <form th:action="@{/admin/users/{id}/delete(id=${user.id})}" method="post" class="d-inline" onsubmit="return confirm('Czy na pewno chcesz usunÄ…Ä‡ tego uÅ¼ytkownika?');">
                                        <button type="submit" class="btn btn-sm btn-danger">UsuÅ„</button>
                                    </form>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Authors Tab -->
            <div class="tab-pane fade" id="authors" role="tabpanel">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2>ZarzÄ…dzanie autorami</h2>
                    <a th:href="@{/admin/authors/add}" class="btn btn-success">+ Dodaj autora</a>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>ImiÄ™</th>
                                <th>Nazwisko</th>
                                <th>NarodowoÅ›Ä‡</th>
                                <th>Liczba ksiÄ…Å¼ek</th>
                                <th>Akcje</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="author : ${authors}">
                                <td th:text="${author.id}">1</td>
                                <td th:text="${author.firstName}">ImiÄ™</td>
                                <td th:text="${author.lastName}">Nazwisko</td>
                                <td th:text="${author.nationality ?: '-'}">NarodowoÅ›Ä‡</td>
                                <td th:text="${author.booksCount ?: 0}">0</td>
                                <td>
                                    <a th:href="@{/admin/authors/{id}/edit(id=${author.id})}" class="btn btn-sm btn-warning">Edytuj</a>
                                    <form th:action="@{/admin/authors/{id}/delete(id=${author.id})}" method="post" class="d-inline" onsubmit="return confirm('Czy na pewno chcesz usunÄ…Ä‡ tego autora?');">
                                        <button type="submit" class="btn btn-sm btn-danger">UsuÅ„</button>
                                    </form>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Reviews Tab -->
            <div class="tab-pane fade" id="reviews" role="tabpanel">
                <h2>Moderacja recenzji</h2>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>UÅ¼ytkownik</th>
                                <th>KsiÄ…Å¼ka</th>
                                <th>TreÅ›Ä‡</th>
                                <th>Data</th>
                                <th>Akcje</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="review : ${reviews}">
                                <td th:text="${review.id}">1</td>
                                <td th:text="${review.username}">UÅ¼ytkownik</td>
                                <td>
                                    <a th:href="@{/books/{id}(id=${review.bookId})}" th:text="${review.bookTitle}">TytuÅ‚ ksiÄ…Å¼ki</a>
                                </td>
                                <td>
                                    <div style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" 
                                         th:text="${review.content}">TreÅ›Ä‡ recenzji...</div>
                                </td>
                                <td th:text="${#temporals.format(review.createdAt, 'dd.MM.yyyy HH:mm')}">Data</td>
                                <td>
                                    <a th:href="@{/books/{id}(id=${review.bookId})}" class="btn btn-sm btn-info">Zobacz</a>
                                    <form th:action="@{/admin/reviews/{id}/delete(id=${review.id})}" method="post" class="d-inline" onsubmit="return confirm('Czy na pewno chcesz usunÄ…Ä‡ tÄ™ recenzjÄ™?');">
                                        <button type="submit" class="btn btn-sm btn-danger">UsuÅ„</button>
                                    </form>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div th:if="${#lists.isEmpty(reviews)}" class="alert alert-info mt-3">
                        Brak recenzji w systemie.
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
